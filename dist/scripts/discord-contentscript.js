"use strict";var runners_paragraph=document.createElement("div"),game_link_container=document.createElement("div"),game_link_a=document.createElement("a");runners_paragraph.id="gdq-runners-information",game_link_container.id="gdq-link-container",game_link_a.id="gdq-speedrun-link",game_link_a.className="speedrun-link",$(document).ready(function(){function t(){$(".discriminator").parent().parent().css("margin-bottom","30px"),$("#gdq-header").after('<div id="twitch-switch" style="position: fixed; width: '+$('div[class^="channels"]').width()+"px; height: 22px; left: "+$(".guilds-wrapper").width()+'px; bottom: 0;"><label for="twitch-player-display" id="twitch-player-display-label">Twitch Player Embed</label></div>'),$("#twitch-switch").append('<input type="checkbox" data-size="mini" name="twitch-player-display">'),$("#twitch-switch").append('<i class="fa fa-expand" id="player-size-icon" style="margin-left: 10px; display: none;"></i>'),$("[name='twitch-player-display']").bootstrapSwitch()}function e(){$(".app").before('\n\t\t\t\t\t\t\t<header id="gdq-header" style="width: '+($('div[class^="titleWrapper"]').width()-$('div[class^="titleWrapper"] div:nth-child(3)').width()-10)+"px; height: "+($('div[class^="titleWrapper"]').outerHeight()-1)+"px; overflow: hidden; min-height: 48px; position: fixed; top: 0px; left: "+($(".guilds-wrapper").width()+$('div[class^="channels"]').width())+'px;">\n\t\t\t\t\t\t\t\t<div class="extension-container">\n\t\t\t\t\t\t\t\t\t<div id="options" style="transform: translateY(37.5%);">\n\t\t\t\t\t\t\t\t\t\t<i class="fa fa-calendar collapsed" data-toggle="collapse" data-target="#collapseCalendar" aria-expanded="false"></i>\n\t\t\t\t\t\t\t\t\t\t<i class="fa fa-refresh" id="settings-icon"></i>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class="game-information">\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div style="clear:both;"></div>\n\t\t\t\t\t\t\t\t\t<div class="collapse" id="collapseCalendar" style="padding-top: 10px; height: 0px;">\n\t\t\t\t\t\t\t\t\t\t<!-- Schedule -->\n\t\t\t\t\t\t\t\t\t\t<p><i class="fa fa-calendar" style="margin-right: 10px;"></i> Next Runs</p>\n\t\t\t\t\t\t\t\t\t\t<table class="table" id="schedule-table" style="border-collapse: collapse;">\n\t\t\t\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</header>\n\t\t\t'),m=$("#gdq-header").css("height"),console.log("Width: "+$("#gdq-header").width()),$(".header-toolbar").css("margin-left","0px"),$(".game-information").append(game_link_container),$("#gdq-link-container").html("<b>Current Game: </b>"),$("#gdq-link-container").append(game_link_a),$(".game-information").append(runners_paragraph),$("#collapseCalendar").on("show.bs.collapse",function(){$("#gdq-header").css("height","auto")}),$("#collapseCalendar").on("hide.bs.collapse",function(){$("#gdq-header").css("height",m)}),q.postMessage({message:"refresh"})}function n(t){"add"==t?(console.log("Switch is on. Adding Twitch iframe and modifying UI."),$("button.active").click(),u=!0,i("add"),$('div[class^="titleWrapper"] > div > :nth-child(3) > :nth-child(3)').is('[class^="iconActive"]')?(g=!0,$(".header-toolbar button:nth-child(3)").click(),f=Math.round($(document).width()-$(".guilds-wrapper").width()-$(".chat").width()*parseFloat($(".messages-wrapper")[0].style.width)/100)):(g=!1,f=$(document).width()-$(".guilds-wrapper").width()-$(".messages-wrapper").width()),$(".app").before('<div id="twitch-container" style="width: '+f+"px; height: "+($(document).height()-$('div[class^="titleWrapper"]').outerHeight()-$("#twitch-switch").outerHeight())+"px; position: fixed; z-index:100; top: "+$('div[class^="titleWrapper"]').outerHeight()+"px; left: "+$(".guilds-wrapper").width()+'px;"></div>'),$(".app").before('<script type="text/javascript">\n\t\t\t\t\t      new Twitch.Embed("twitch-container", {\n\t\t\t\t\t        width: "100%",\n\t\t\t\t\t        height: "100%",\n\t\t\t\t\t\t\t\t\tlayout: "video",\n\t\t\t\t\t\t\t\t\tallowfullscreen: true,\n\t\t\t\t\t        channel: "gamesdonequick"\n\t\t\t\t\t      });\n\t\t\t\t\t    </script>')):"remove"==t&&(console.log("Switch is off. Removing Twitch iframe and UI changes."),$("#twitch-container").remove(),u=!1,i("remove"),1==g&&$(".header-toolbar button:nth-child(3)").click())}function a(t){"large"==w?($("#twitch-container").css("width","70%"),$(".messages-wrapper").css("width","32%"),$(".messages-wrapper").next("form").css({width:"29%","margin-right":"2%","margin-left":"0px"})):"small"==w&&($(".messages-wrapper").css("width","48%"),$(".messages-wrapper").next("form").css({width:"46%","margin-right":"2%","margin-left":"0px"}),$("#twitch-container").css("width",$(document).width()-$(".guilds-wrapper").width()-$(".messages-wrapper").width()))}function s(t){"add"==t?$("#gdq-header").css("display",""):"remove"==t&&$("#gdq-header").css("display","none")}function i(t){console.log("TwitchActive: "+u),"add"==t?(console.log("Rearranging Discord UI"),$(".messages-wrapper").parent().css("align-items","flex-end"),a(w),$("#player-size-icon").css("display","inline-block")):"remove"==t&&(console.log("Discord UI returned to normal"),$(".messages-wrapper").parent().removeAttr("style"),$(".messages-wrapper").removeAttr("style"),$(".messages-wrapper").next("form").removeAttr("style"),$("#player-size-icon").css("display","none"))}function l(t){$("#gdq-runners-information").html(o(t.runner,"header")),$("#gdq-speedrun-link").attr("href",t.link),null!=t.category?$("#gdq-speedrun-link").html(t.game+" ("+t.category+")"):$("#gdq-speedrun-link").html(""+t.game)}function r(t){if(console.log("Calendar updating..."),console.log(t),null!=t){console.log("Calendar not null."),$("#schedule-table tbody").empty();var e="";_.each(t.order,function(n,a){e+=d(t.schedule[n],t.highlights,a+1),console.log(e)}),$("#schedule-table tbody").html(e),console.log("Calendar updated.")}}function o(t,e){var n=_.keys(t),a="by ";if(n.length>2){"table"!=e&&(a="<b>Current Runners: </b>");var s=n.pop(),i=n.pop();$.each(n,function(e,n){a+=c(t,n)+", "}),a+=c(t,i)+" ",a+="and ",a+=c(t,s)}else if(2==n.length){"table"!=e&&(a="<b>Current Runners: </b>");var s=n.pop(),i=n.pop();a+=c(t,i),a+=" and ",a+=c(t,s)}else if(1==n.length){"table"!=e&&(a="<b>Current Runner: </b>");n[0];a+=c(t,n[0])}else console.log("Error no runners."),a="";return a}function c(t,e){return null==t[e].logo?'<a href="'+t[e].link+'" onclick="window.open(this.href); return false;">'+e+"</a>":'<a href="'+t[e].link+'" onclick="window.open(this.href); return false;"><img class="runner-logo" src="'+t[e].logo+'" style="width: 14px;"/>'+e+"</a>"}function d(t,e,n){console.log(t),console.log(e);var a=o(t.runner,"table");if(null!=t.category)var s=t.title+" ("+t.category+")";else var s=t.title;if("undefined"==typeof e[t.title]||0==e[t.title])var i="";else{var i="background-color:#555555;";s='<i class="fa fa-star"></i> '+s}var l="<tr style="+i+'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<th scope="row" style="text-align: center; vertical-align: middle;">'+n+'</th>\n\t                                <td>\n\t                                    <a class="speedrun-link" id="next-game-title" href="'+t.link+'" onclick="window.open(this.href); return false;"> '+s+'</a>\n\t                                    <p class="runners-links" id="next-runners-information">'+a+'</p>\n\t                                </td>\n\t                                <td style="text-align: center; vertical-align: middle;">\n\t                                    <p class="text-right"><i class="fa fa-clock-o" aria-hidden="true"></i> '+t.estimate+"</p>\n\t                                </td>\n\t                              </tr>";return l}function h(){q.postMessage({message:"request"})}function p(){q.postMessage({message:"refresh"})}console.log("Hello Discord!");var g=null,u=!1,m=null,f=$(document).width()-$(".guilds-wrapper").width()-$(".messages-wrapper").width(),w="small",v=document.createElement("style");v.type="text/css",v.textContent="@font-face { font-family: FontAwesome; src: url("+chrome.extension.getURL("/fonts/fontawesome-webfont.woff")+");}",document.head.appendChild(v);var y=setInterval(function(){$('[class^="accountDetails"]').length>0&&($(".guild.selected").has('a[href^="/channels/140605087511740416/"]').length>0||$(".guild.selected").has('a[href^="/channels/85369684286767104/"]').length>0)&&(console.log("Add Switch to Links Panel"),e(),t(),clearInterval(y),$('input[name="twitch-player-display"]').on("switchChange.bootstrapSwitch",function(t,e){console.log("Clicked Twitch Switch. Current switch state: "+$("[name='twitch-player-display']").bootstrapSwitch("state")),n($('input[name="twitch-player-display"]').bootstrapSwitch("state")?"add":"remove")}))},1e3),b=setInterval(function(){$(".fa-refresh").length>0&&($(".fa.fa-refresh").click(function(){this.className="fa fa-refresh fa-spin",console.log("Refreshing..."),p();var t=this;console.log(t),setTimeout(function(){t.className="fa fa-refresh",console.log("Refresh complete.")},2e3)}),clearInterval(b))},1e3),x=setInterval(function(){$("#player-size-icon").length>0&&($("#player-size-icon").click(function(){console.log("Clicked size icon"),$("#player-size-icon").hasClass("fa-expand")?(console.log("EXPAND"),w="large",a(w),this.className="fa fa-compress"):$("#player-size-icon").hasClass("fa-compress")&&(console.log("COMPRESS"),console.log(f),w="small",a(w),this.className="fa fa-expand")}),clearInterval(x))},1e3),k=setInterval(function(){$(".selected").length>0&&($(document).on("click",".guild",function(){if(u)if($(this).has('a[href^="/channels/140605087511740416/"]').length>0||$(this).has('a[href^="/channels/85369684286767104"]').length>0){$("#twitch-container").css("display","");var t=setInterval(function(){$('[class^="channels"]').length>0&&("GamesDoneQuick"==$('[class^="channels"] header span').text()||"European Speedrunner Assembly"==$('[class^="channels"] header span]').text())&&(i("add"),clearInterval(t))},500)}else $("#twitch-container").css("display","none"),i("remove");$("#twitch-switch").length&&$(".discriminator",$('[class^="channels"]')).parent().parent().css("margin-bottom","30px"),s($(this).has('a[href^="/channels/140605087511740416/"]').length>0||$(this).has('a[href^="/channels/85369684286767104"]').length>0?"add":"remove")}),$(".dms").on("click",function(){s("remove"),u&&($("#twitch-container").css("display","none"),i("remove"))}),clearInterval(k))},1e3),q=chrome.runtime.connect({name:"gdq"});q.postMessage({message:"request"}),q.onMessage.addListener(function(t){"changed"==t.status?(console.log(t),console.log("The Current Game is: "+t.game),$("#gdq-header").length>0&&(l(t),r(t.calendar))):"unchanged"==t.status?console.log("Current game has not changed since last request"):"reload"==t.status&&(console.log("Reload has occurred"),console.log(t),console.log("The Current Game is: "+t.game),$("#gdq-header").length>0&&(l(t),r(t.calendar)))}),setInterval(h,3e5)});
//# sourceMappingURL=discord-contentscript.js.map
