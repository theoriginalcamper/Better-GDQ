{"version":3,"sources":["scripts/discord-contentscript.js"],"names":["runners_paragraph","document","createElement","game_link_container","game_link_a","id","$","ready","addTwitchSwitch","parent","css","after","width","append","bootstrapSwitch","addInformationBar","before","outerHeight","headerHeight","console","log","html","on","port","postMessage","message","updateTwitchPlayer","msg","click","twitchActive","updateDiscordUI","Math","round","parseFloat","style","twitchPlayerInitialSize","height","remove","userListStatus","adjustTwitchPlayerSize","twitchPlayerSizeState","next","margin-right","margin-left","updateGDQHeaderDisplay","removeAttr","updateGDQHeaderUI","generateFormattedRunnerString","runner","attr","link","category","game","updateCalendarUI","empty","scheduleString","_","each","order","gameTitle","index","generateScheduleItemString","schedule","highlights","runners","location","runners_keys","keys","runner_string","length","last_runner","pop","second_runner","runner_key","generateRunnerElement","runnerObject","scheduleItemObject","highlightsObject","runnerString","titleString","title","highlightStyle","scheduleItemString","estimate","requestDataFromBackground","refreshDataFromBackground","styleNode","type","textContent","chrome","extension","getURL","head","appendChild","checkAccount","setInterval","guildList","filter","classList","this","split","match","value","test","has","clearInterval","event","state","checkRefresh","className","that","setTimeout","checkPlayerSize","hasClass","checkForActiveGuild","uiUpdate","text","runtime","connect","name","onMessage","addListener","status","calendar"],"mappings":"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","file":"discord-contentscript.js","sourcesContent":["'use strict';\n\nvar runners_paragraph = document.createElement('div');\nvar game_link_container = document.createElement('div');\nvar game_link_a = '<a id=\"gdq-speedrun-link\" class=\"speedrun-link\" onclick=\"window.open(this.href); return false;\"></a>';\n\nrunners_paragraph.id = \"gdq-runners-information\";\ngame_link_container.id = \"gdq-link-container\";\n\n$(document).ready(function () {\n\tconsole.log(\"Hello Discord!\");\n\n\tvar userListStatus = null;\n\tvar twitchActive = false;\n\tvar headerHeight = null;\n\tvar twitchPlayerInitialSize = $(document).width() - $('.guilds-wrapper').width() - $('.messages-wrapper').width();\n\tvar twitchPlayerSizeState = 'small';\n\n\tvar styleNode = document.createElement(\"style\");\n\tstyleNode.type = \"text/css\";\n\tstyleNode.textContent = '@font-face { font-family: FontAwesome; src: url(' + chrome.extension.getURL(\"/fonts/fontawesome-webfont.woff\") + ');}';\n\tdocument.head.appendChild(styleNode);\n\n\tvar checkAccount = setInterval(function () {\n\t\tif ($('[class^=\"accountDetails\"]').length > 0) {\n\n\t\t\tvar guildList = $('[class^=\"guild-\"]').filter(function (index) {\n\t\t\t\tvar classList = $(this).attr('class').split(' ');\n\t\t\t\tvar match = classList.filter(function (value) {\n\t\t\t\t\treturn (/^selected-/.test(value)\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\tif (match.length > 0) {\n\t\t\t\t\treturn $(this);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (guildList.has('a[href^=\"/channels/140605087511740416/\"]').length > 0 || guildList.has('a[href^=\"/channels/85369684286767104/\"]').length > 0) {\n\t\t\t\t// Check if element has been found\n\t\t\t\tconsole.log('Add Switch to Links Panel');\n\t\t\t\taddInformationBar();\n\t\t\t\taddTwitchSwitch();\n\n\t\t\t\tclearInterval(checkAccount);\n\n\t\t\t\t$('input[name=\"twitch-player-display\"]').on('switchChange.bootstrapSwitch', function (event, state) {\n\t\t\t\t\tconsole.log('Clicked Twitch Switch. Current switch state: ' + $(\"[name='twitch-player-display']\").bootstrapSwitch('state'));\n\t\t\t\t\tif ($('input[name=\"twitch-player-display\"]').bootstrapSwitch('state')) {\n\t\t\t\t\t\tupdateTwitchPlayer('add');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tupdateTwitchPlayer('remove');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}, 1000);\n\n\tvar checkRefresh = setInterval(function () {\n\t\tif ($(\".fa-refresh\").length > 0) {\n\t\t\t// Check if element has been found\n\t\t\t$(\".fa.fa-refresh\").click(function () {\n\t\t\t\tthis.className = 'fa fa-refresh fa-spin';\n\t\t\t\tconsole.log(\"Refreshing...\");\n\t\t\t\trefreshDataFromBackground();\n\t\t\t\tvar that = this;\n\t\t\t\tconsole.log(that);\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tthat.className = 'fa fa-refresh';\n\t\t\t\t\tconsole.log(\"Refresh complete.\");\n\t\t\t\t}, 2000);\n\t\t\t});\n\t\t\tclearInterval(checkRefresh);\n\t\t}\n\t}, 1000);\n\n\tvar checkPlayerSize = setInterval(function () {\n\t\tif ($(\"#player-size-icon\").length > 0) {\n\t\t\t// Check if element has been found\n\t\t\t$(\"#player-size-icon\").click(function () {\n\t\t\t\tconsole.log(\"Clicked size icon\");\n\t\t\t\tif ($(\"#player-size-icon\").hasClass(\"fa-expand\")) {\n\t\t\t\t\tconsole.log(\"EXPAND\");\n\t\t\t\t\ttwitchPlayerSizeState = 'large';\n\t\t\t\t\tadjustTwitchPlayerSize(twitchPlayerSizeState);\n\t\t\t\t\tthis.className = 'fa fa-compress';\n\t\t\t\t} else if ($(\"#player-size-icon\").hasClass(\"fa-compress\")) {\n\t\t\t\t\tconsole.log(\"COMPRESS\");\n\t\t\t\t\tconsole.log(twitchPlayerInitialSize);\n\t\t\t\t\ttwitchPlayerSizeState = 'small';\n\t\t\t\t\tadjustTwitchPlayerSize(twitchPlayerSizeState);\n\t\t\t\t\tthis.className = 'fa fa-expand';\n\t\t\t\t}\n\t\t\t});\n\t\t\tclearInterval(checkPlayerSize);\n\t\t}\n\t}, 1000);\n\n\tfunction addTwitchSwitch() {\n\t\t$('.discriminator').parent().parent().css('margin-bottom', '30px');\n\t\t$('#gdq-header').after('<div id=\"twitch-switch\" style=\"position: fixed; width: ' + $('div[class^=\"channels\"]').width() + 'px; height: 22px; left: ' + $('[class^=\"guildsWrapper\"]').width() + 'px; bottom: 0;\"><label for=\"twitch-player-display\" id=\"twitch-player-display-label\">Twitch Player Embed</label></div>');\n\t\t$('#twitch-switch').append('<input type=\"checkbox\" data-size=\"mini\" name=\"twitch-player-display\">');\n\t\t$('#twitch-switch').append('<i class=\"fa fa-expand\" id=\"player-size-icon\" style=\"margin-left: 10px; display: none;\"></i>');\n\n\t\t$(\"[name='twitch-player-display']\").bootstrapSwitch();\n\t}\n\n\tfunction addInformationBar() {\n\n\t\t$('.app').before('\\n\\t\\t\\t\\t\\t\\t\\t<header id=\"gdq-header\" style=\"width: ' + ($('div[class^=\"titleWrapper\"]').width() - $('div[class^=\"titleWrapper\"] > div > div:nth-child(2)').width() - 10) + 'px; height: ' + ($('div[class^=\"titleWrapper\"]').outerHeight() - 1) + 'px; overflow: hidden; min-height: 48px; position: fixed; top: 0px; left: ' + ($('[class^=\"guildsWrapper\"]').width() + $('div[class^=\"channels\"]').width()) + 'px;\">\\n\\t\\t\\t\\t\\t\\t\\t\\t<div class=\"extension-container\">\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<div id=\"options\" style=\"transform: translateY(37.5%);\">\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<i class=\"fa fa-calendar collapsed\" data-toggle=\"collapse\" data-target=\"#collapseCalendar\" aria-expanded=\"false\"></i>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<i class=\"fa fa-refresh\" id=\"settings-icon\"></i>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t</div>\\n\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<div class=\"game-information\">\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t</div>\\n\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<div style=\"clear:both;\"></div>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<div class=\"collapse\" id=\"collapseCalendar\" style=\"padding-top: 10px; height: 0px;\">\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<!-- Schedule -->\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<p><i class=\"fa fa-calendar\" style=\"margin-right: 10px;\"></i> Next Runs</p>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<table class=\"table\" id=\"schedule-table\" style=\"border-collapse: collapse;\">\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<tbody>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t</tbody>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t</table>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t\\t\\t\\t</header>\\n\\t\\t\\t');\n\n\t\theaderHeight = $('#gdq-header').css('height');\n\t\tconsole.log('Width: ' + $('#gdq-header').width());\n\t\t$('.header-toolbar').css('margin-left', '0px');\n\t\t$('.game-information').append(game_link_container);\n\t\t$('#gdq-link-container').html('<b>Current Game: </b>');\n\t\t$('#gdq-link-container').append(game_link_a);\n\t\t$('.game-information').append(runners_paragraph);\n\n\t\t$('#collapseCalendar').on('show.bs.collapse', function () {\n\t\t\t$('#gdq-header').css('height', 'auto');\n\t\t});\n\n\t\t$('#collapseCalendar').on('hide.bs.collapse', function () {\n\t\t\t$('#gdq-header').css('height', headerHeight);\n\t\t});\n\n\t\tport.postMessage({ message: \"refresh\" });\n\t}\n\n\tfunction updateTwitchPlayer(msg) {\n\t\tif (msg == 'add') {\n\t\t\tconsole.log('Switch is on. Adding Twitch iframe and modifying UI.');\n\n\t\t\t$('button.active').click();\n\n\t\t\ttwitchActive = true;\n\n\t\t\tupdateDiscordUI('add');\n\n\t\t\t// if($('div[class^=\"titleWrapper\"] > div > :nth-child(3) > :nth-child(3)').is('[class^=\"iconActive\"]')) {\n\t\t\t// \tuserListStatus = true;\n\t\t\t// \t$('.header-toolbar button:nth-child(3)').click();\n\t\t\t// \t// $('.channel-members-wrap').css('display', 'none');\n\t\t\t// \ttwitchPlayerInitialSize = Math.round($(document).width() - $('[class^=\"guildsWrapper\"]').width() - ($('[class^=\"chat\"]').width() * (parseFloat($('[class^=\"messagesWrapper\"]')[0].style.width)) / 100));\n\t\t\t// } else {\n\t\t\t// \tuserListStatus = false;\n\t\t\t// \ttwitchPlayerInitialSize = $(document).width() - $('[class^=\"guildsWrapper\"]').width() - $('[class^=\"messagesWrapper\"]').width();\n\t\t\t// }\n\t\t\tconsole.log(Math.round($(document).width() - $('[class^=\"guildsWrapper\"]').width() - $('[class^=\"chat\"]').width() * parseFloat($('[class^=\"messagesWrapper\"]')[0].style.width) / 100));\n\t\t\ttwitchPlayerInitialSize = Math.round($(document).width() - $('[class^=\"guildsWrapper\"]').width() - $('[class^=\"chat\"]').width() * parseFloat($('[class^=\"messagesWrapper\"]')[0].style.width) / 100);\n\n\t\t\t$('.app').before('<div id=\"twitch-container\" style=\"width: ' + twitchPlayerInitialSize + 'px; height: ' + ($(document).height() - $('div[class^=\"titleWrapper\"]').outerHeight() - $('#twitch-switch').outerHeight()) + 'px; position: fixed; z-index:100; top: ' + $('div[class^=\"titleWrapper\"]').outerHeight() + 'px; left: ' + $('[class^=\"guildsWrapper\"]').width() + 'px;\"></div>');\n\t\t\t$('.app').before('<script type=\"text/javascript\">\\n\\t\\t\\t\\t\\t      new Twitch.Embed(\"twitch-container\", {\\n\\t\\t\\t\\t\\t        width: \"100%\",\\n\\t\\t\\t\\t\\t        height: \"100%\",\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tlayout: \"video\",\\n\\t\\t\\t\\t\\t\\t\\t\\t\\tallowfullscreen: true,\\n\\t\\t\\t\\t\\t        channel: \"gamesdonequick\"\\n\\t\\t\\t\\t\\t      });\\n\\t\\t\\t\\t\\t    </script>');\n\t\t} else if (msg == 'remove') {\n\t\t\tconsole.log('Switch is off. Removing Twitch iframe and UI changes.');\n\t\t\t$('#twitch-container').remove();\n\t\t\ttwitchActive = false;\n\t\t\tupdateDiscordUI('remove');\n\n\t\t\tif (userListStatus == true) {\n\t\t\t\t$('.header-toolbar button:nth-child(3)').click();\n\t\t\t\t// $('.channel-members-wrap').css('display', '')\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction adjustTwitchPlayerSize(msg) {\n\t\tif (twitchPlayerSizeState == 'large') {\n\t\t\t// Switch to large display\n\t\t\t$('#twitch-container').css('width', '70%');\n\t\t\t$('[class^=\"messagesWrapper\"]').css('width', '32%');\n\t\t\t$('[class^=\"messagesWrapper\"]').next('form').css({ 'width': '29%', 'margin-right': '2%', 'margin-left': '0px' });\n\t\t} else if (twitchPlayerSizeState == 'small') {\n\t\t\t// Switch to small display\n\t\t\t// $('#twitch-container').css('width', twitchPlayerInitialSize);\n\t\t\t$('[class^=\"messagesWrapper\"]').css('width', '48%');\n\t\t\t$('[class^=\"messagesWrapper\"]').next('form').css({ 'width': '46%', 'margin-right': '2%', 'margin-left': '0px' });\n\t\t\t$('#twitch-container').css('width', $(document).width() - $('[class^=\"guildsWrapper\"]').width() - $('[class^=\"messagesWrapper\"]').width());\n\t\t}\n\t}\n\n\tfunction updateGDQHeaderDisplay(msg) {\n\t\tif (msg == 'add') {\n\t\t\t$('#gdq-header').css('display', '');\n\t\t} else if (msg == 'remove') {\n\t\t\t$('#gdq-header').css('display', 'none');\n\t\t}\n\t}\n\n\tfunction updateDiscordUI(msg) {\n\t\tconsole.log(\"TwitchActive: \" + twitchActive);\n\t\tif (msg == 'add') {\n\t\t\tconsole.log(\"Rearranging Discord UI\");\n\t\t\t$('[class^=\"messagesWrapper\"]').parent().css('align-items', 'flex-end');\n\t\t\tadjustTwitchPlayerSize(twitchPlayerSizeState);\n\t\t\t$('#player-size-icon').css('display', 'inline-block');\n\t\t} else if (msg == 'remove') {\n\t\t\tconsole.log(\"Discord UI returned to normal\");\n\t\t\t$('[class^=\"messagesWrapper\"]').parent().removeAttr('style');\n\t\t\t$('[class^=\"messagesWrapper\"]').removeAttr('style');\n\t\t\t$('[class^=\"messagesWrapper\"]').next('form').removeAttr('style');\n\t\t\t$('#player-size-icon').css('display', 'none');\n\t\t}\n\t}\n\n\tfunction updateGDQHeaderUI(msg) {\n\t\t$('#gdq-runners-information').html(generateFormattedRunnerString(msg.runner, 'header'));\n\t\t$('#gdq-speedrun-link').attr('href', msg.link);\n\n\t\tif (msg.category != null) {\n\t\t\t$('#gdq-speedrun-link').html(msg.game + ' (' + msg.category + ')');\n\t\t} else {\n\t\t\t$('#gdq-speedrun-link').html('' + msg.game);\n\t\t}\n\t}\n\n\tfunction updateCalendarUI(msg) {\n\t\tconsole.log(\"Calendar updating...\");\n\t\tconsole.log(msg);\n\t\tif (msg != null) {\n\t\t\tconsole.log(\"Calendar not null.\");\n\t\t\t$('#schedule-table tbody').empty();\n\n\t\t\tvar scheduleString = \"\";\n\t\t\t_.each(msg.order, function (gameTitle, index) {\n\t\t\t\tscheduleString += generateScheduleItemString(msg.schedule[gameTitle], msg.highlights, index + 1);\n\t\t\t\tconsole.log(scheduleString);\n\t\t\t});\n\n\t\t\t$('#schedule-table tbody').html(scheduleString);\n\t\t\tconsole.log(\"Calendar updated.\");\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t}\n\n\tfunction generateFormattedRunnerString(runners, location) {\n\t\tvar runners_keys = _.keys(runners);\n\t\tvar runner_string = \"by \";\n\n\t\tif (location != 'table') {\n\t\t\trunner_string = \"<b>Current Runners: </b>\";\n\t\t}\n\n\t\tif (runners_keys.length > 2) {\n\t\t\tvar last_runner = runners_keys.pop();\n\t\t\tvar second_runner = runners_keys.pop();\n\t\t\t$.each(runners_keys, function (index, runner_key) {\n\t\t\t\trunner_string += generateRunnerElement(runners, runner_key) + ', ';\n\t\t\t});\n\n\t\t\trunner_string += generateRunnerElement(runners, second_runner) + ' ';\n\t\t\trunner_string += 'and ';\n\t\t\trunner_string += generateRunnerElement(runners, last_runner);\n\t\t} else if (runners_keys.length == 2) {\n\t\t\tvar last_runner = runners_keys.pop();\n\t\t\tvar second_runner = runners_keys.pop();\n\n\t\t\trunner_string += generateRunnerElement(runners, second_runner);\n\t\t\trunner_string += ' and ';\n\t\t\trunner_string += generateRunnerElement(runners, last_runner);\n\t\t} else if (runners_keys.length == 1) {\n\t\t\tvar runner_key = runners_keys[0];\n\t\t\trunner_string += generateRunnerElement(runners, runners_keys[0]);\n\t\t} else {\n\t\t\tconsole.log(\"Error no runners.\");\n\t\t\trunner_string = \"\";\n\t\t}\n\t\treturn runner_string;\n\t}\n\n\tfunction generateRunnerElement(runnerObject, runner_key) {\n\t\tif (runnerObject[runner_key][\"logo\"] == null) {\n\t\t\treturn '<a href=\"' + runnerObject[runner_key][\"link\"] + '\" onclick=\"window.open(this.href); return false;\">' + runner_key + '</a>';\n\t\t} else {\n\t\t\treturn '<a href=\"' + runnerObject[runner_key][\"link\"] + '\" onclick=\"window.open(this.href); return false;\"><img class=\"runner-logo\" src=\"' + runnerObject[runner_key][\"logo\"] + '\" style=\"width: 14px;\"/>' + runner_key + '</a>';\n\t\t}\n\t}\n\n\tfunction generateScheduleItemString(scheduleItemObject, highlightsObject, index) {\n\t\tconsole.log(scheduleItemObject);\n\t\tconsole.log(highlightsObject);\n\t\tvar runnerString = generateFormattedRunnerString(scheduleItemObject.runner, 'table');\n\t\tif (scheduleItemObject.category != null) {\n\t\t\tvar titleString = scheduleItemObject.title + ' (' + scheduleItemObject.category + ')';\n\t\t} else {\n\t\t\tvar titleString = scheduleItemObject.title;\n\t\t}\n\n\t\tif (typeof highlightsObject[scheduleItemObject.title] == 'undefined' || highlightsObject[scheduleItemObject.title] == false) {\n\t\t\tvar highlightStyle = '';\n\t\t} else {\n\t\t\tvar highlightStyle = 'background-color:#555555;';\n\t\t\ttitleString = '<i class=\"fa fa-star\"></i> ' + titleString;\n\t\t}\n\n\t\tvar scheduleItemString = '<tr style=' + highlightStyle + '>\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t<th scope=\"row\" style=\"text-align: center; vertical-align: middle;\">' + index + '</th>\\n\\t                                <td>\\n\\t                                    <a class=\"speedrun-link\" id=\"next-game-title\" href=\"' + scheduleItemObject.link + '\" onclick=\"window.open(this.href); return false;\"> ' + titleString + '</a>\\n\\t                                    <p class=\"runners-links\" id=\"next-runners-information\">' + runnerString + '</p>\\n\\t                                </td>\\n\\t                                <td style=\"text-align: center; vertical-align: middle;\">\\n\\t                                    <p class=\"text-right\"><i class=\"fa fa-clock-o\" aria-hidden=\"true\"></i> ' + scheduleItemObject.estimate + '</p>\\n\\t                                </td>\\n\\t                              </tr>';\n\n\t\treturn scheduleItemString;\n\t}\n\n\tvar checkForActiveGuild = setInterval(function () {\n\t\tif ($('[class*=\"selected-\"]').length > 0) {\n\t\t\t// Check if element has been found\n\t\t\t$(document).on('click', '[class^=\"guild-\"]', function () {\n\t\t\t\tif (twitchActive) {\n\t\t\t\t\tif ($(this).has('a[href^=\"/channels/140605087511740416/\"]').length > 0 || $(this).has('a[href^=\"/channels/85369684286767104\"]').length > 0) {\n\t\t\t\t\t\t$('#twitch-container').css('display', '');\n\n\t\t\t\t\t\tvar uiUpdate = setInterval(function () {\n\t\t\t\t\t\t\tif ($('[class^=\"channels\"]').length > 0 && ($('[class^=\"channels\"] header span').text() == 'GamesDoneQuick' || $('[class^=\"channels\"] header span').text() == 'European Speedrunner Assembly')) {\n\t\t\t\t\t\t\t\tupdateDiscordUI('add');\n\t\t\t\t\t\t\t\tclearInterval(uiUpdate);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 500);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$('#twitch-container').css('display', 'none');\n\t\t\t\t\t\tupdateDiscordUI('remove');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($('#twitch-switch').length) {\n\t\t\t\t\t$('.discriminator', $('[class^=\"channels\"]')).parent().parent().css('margin-bottom', '30px');\n\t\t\t\t}\n\n\t\t\t\tif ($(this).has('a[href^=\"/channels/140605087511740416/\"]').length > 0 || $(this).has('a[href^=\"/channels/85369684286767104\"]').length > 0) {\n\t\t\t\t\tupdateGDQHeaderDisplay('add');\n\t\t\t\t} else {\n\t\t\t\t\tupdateGDQHeaderDisplay('remove');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$('.dms').on('click', function () {\n\t\t\t\tupdateGDQHeaderDisplay('remove');\n\t\t\t\tif (twitchActive) {\n\t\t\t\t\t$('#twitch-container').css('display', 'none');\n\t\t\t\t\tupdateDiscordUI('remove');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tclearInterval(checkForActiveGuild);\n\t\t}\n\t}, 1000);\n\n\tvar port = chrome.runtime.connect({ name: \"gdq\" });\n\tport.postMessage({ message: \"request\" });\n\tport.onMessage.addListener(function (msg) {\n\t\tif (msg.status == \"changed\") {\n\t\t\tconsole.log(msg);\n\t\t\tconsole.log(\"The Current Game is: \" + msg.game);\n\n\t\t\tif ($('#gdq-header').length > 0) {\n\t\t\t\tupdateGDQHeaderUI(msg);\n\t\t\t\tupdateCalendarUI(msg.calendar);\n\t\t\t}\n\t\t} else if (msg.status == \"unchanged\") {\n\t\t\tconsole.log(\"Current game has not changed since last request\");\n\t\t} else if (msg.status == \"reload\") {\n\t\t\tconsole.log(\"Reload has occurred\");\n\t\t\tconsole.log(msg);\n\t\t\tconsole.log(\"The Current Game is: \" + msg.game);\n\t\t\tif ($('#gdq-header').length > 0) {\n\t\t\t\tupdateGDQHeaderUI(msg);\n\t\t\t\tupdateCalendarUI(msg.calendar);\n\t\t\t}\n\t\t}\n\t});\n\tfunction requestDataFromBackground() {\n\t\tport.postMessage({ message: \"request\" });\n\t}\n\tfunction refreshDataFromBackground() {\n\t\tport.postMessage({ message: \"refresh\" });\n\t}\n\tsetInterval(requestDataFromBackground, 300000);\n});"]}